<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  
  <title>상품 조회 - Ewha Market</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  {% include 'navbar.html' %}

  <div class="container fade">

   
    <div class="page-head">
      {% if total > 0%}
      <h2>상품 조회 -- 현재까지 {{total}}개 등록됨</h2>
      <div class="page-actions">
        <a href="/register" class="btn">+ 상품 등록</a>
      </div>
    </div>

    <section class="grid">
    {% for row in [row1, row2] %}  {# row1, row2를 리스트로 묶어서 반복 #}
     {% for key, value in row %}
        <article class="card prod"
            onclick="location.href='/product_detail/{{ value.name }}/';"
            style="cursor:pointer;">

          <img src="{{ url_for('static', filename='image/' ~ value.image) }}" width="140" height="200">

         <div class="name" style="display:flex; align-items:center; gap:6px;">
            {{ value.name }}
            {% if value.liked %}
              <i class="fa fa-heart" style="color:red; cursor:pointer;"
                onclick="event.stopPropagation(); toggleLike('{{ value.name }}')"></i>
            {% else %}
              <i class="fa fa-heart" style="color:grey; cursor:pointer;"
                  onclick="event.stopPropagation(); toggleLike('{{ value.name }}')"></i>
            {% endif %}
         </div>
          <div class="price">₩{{ value.price }}</div>
          <p style="font-size:13px; color:var(--muted);">
            판매자: {{ value.seller }}<br>
            지역: {{ value.location }}<br>
            상태: {{ value.condition }}
          </p>
        </article>

      {% endfor %}
    {% endfor %}
    </section>
    <!-- 페이지네이션 -->
  <div class="pagination">
  {% for i in range(page_count) %}
    {% set page_num = i + 1 %}
    {% if i == page %}
      <span class="page active">{{ page_num }}</span>
    {% else %}
      <a href="{{ url_for('product_list', page=i) }}" class="page">{{ page_num }}</a>
    {% endif %}
  {% endfor %}
</div>
  
      
  </div>
  {%else%}
    <p> 등록된 상품이 없습니다. </p>
  {%endif%}

<script>
  function toggleLike(name) {
    fetch(`/toggle_like/${name}`, { method: "POST" })
      .then(() => location.reload());
  }
</script>

<script>
  window.addEventListener("pageshow", function(event) {
    if (event.persisted) {
        window.location.reload();
    }
  });
</script>

<script src="{{ url_for('static', filename='main.js') }}"></script> 
</body>
</html>

